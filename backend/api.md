# ğŸ›¡ï¸ Night Safety API (v1.0.0)

æä¾›ã€Œå¤œæ­¸å®‰å…¨ APPã€æŸ¥è©¢é™„è¿‘å®‰å…¨è³‡æºèˆ‡å€åŸŸå®‰å…¨è©•ä¼°çš„ä»‹é¢ã€‚

Base URLï¼š
```
http://localhost:5001
```

---

## ğŸ§­ `GET /get_safety_data`

### èªªæ˜
å–å¾—æŒ‡å®šä½ç½®å‘¨åœçš„å®‰å…¨è³‡æºï¼ˆç›£è¦–å™¨ã€æ·é‹ç«™ã€è·¯ç‡ˆã€è­¦å±€ã€æ¶å¥ªæ¡ˆä»¶ï¼‰èˆ‡å®‰å…¨åˆ†æ•¸ã€‚

### Query åƒæ•¸
| åƒæ•¸ | é¡å‹ | å¿…å¡« | é è¨­å€¼ | èªªæ˜ |
|------|------|------|--------|------|
| `center_lat` | number | âœ… | 25.033964 | ä¸­å¿ƒé»ç·¯åº¦ |
| `center_lng` | number | âœ… | 121.564468 | ä¸­å¿ƒé»ç¶“åº¦ |
| `radius_m` | int | âŒ | 200 | æœå°‹åŠå¾‘ï¼ˆå…¬å°ºï¼‰ |
| `at` | string | âŒ | 2025-11-08T23:00:00+08:00 | æŸ¥è©¢æ™‚é–“ï¼ˆISO 8601 æ ¼å¼ï¼‰ |
| `tz` | string | âŒ | Asia/Taipei | æ™‚å€ |

### ç¯„ä¾‹è«‹æ±‚
```bash
curl -X GET "http://localhost:5001/get_safety_data?center_lat=25.033964&center_lng=121.564468&radius_m=200"
```

### æˆåŠŸå›å‚³ç¯„ä¾‹
```json
{
  "meta": {
    "at": "2025-11-08T23:00:00+08:00",
    "center": { "lat": 25.033964, "lng": 121.564468 },
    "radius_m": 200,
    "tz": "Asia/Taipei"
  },
  "summary": {
    "safety_score": 45.5,
    "analysis": {
      "cctv_count": 8,
      "metro_count": 2,
      "robbery_count": 1,
      "streetlight_count": 25,
      "police_count": 0
    }
  },
  "resources": {
    "cctv": [
      {
        "safety": 1,
        "type": "cctv",
        "name": "CAM-12345",
        "location": { "lat": 25.03452, "lng": 121.56501 },
        "distance_m": 65,
        "phone": ""
      }
    ],
    "metro": [
      {
        "safety": 1,
        "type": "metro",
        "name": "å¸‚æ”¿åºœç«™ 1 è™Ÿå‡ºå£",
        "location": { "lat": 25.03398, "lng": 121.56512 },
        "distance_m": 120,
        "phone": ""
      }
    ],
    "criminal": [
      {
        "safety": -1,
        "type": "robbery_incident",
        "name": "æ¶å¥ªæ¡ˆä»¶ - 2024-10-15",
        "location": { "lat": 25.03301, "lng": 121.56389 },
        "distance_m": 180,
        "incident_date": "2024-10-15",
        "incident_time": "22:00-24:00",
        "location_desc": "ä¿¡ç¾©å€å¸‚åºœè·¯",
        "phone": ""
      }
    ],
    "streetlight": [
      {
        "safety": 1,
        "type": "streetlight",
        "name": "LIGHT-67890",
        "location": { "lat": 25.03421, "lng": 121.56478 },
        "distance_m": 45,
        "phone": ""
      }
    ],
    "police": [
      {
        "safety": 1,
        "type": "police",
        "name": "ä¿¡ç¾©åˆ†å±€",
        "location": { "lat": 25.03289, "lng": 121.56234 },
        "distance_m": 340,
        "phone": "110",
        "open_now": true
      }
    ]
  }
}
```

### å›å‚³æ¬„ä½èªªæ˜

#### `meta` ç‰©ä»¶
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `at` | string | æŸ¥è©¢æ™‚é–“ |
| `center` | object | æŸ¥è©¢ä¸­å¿ƒé»åº§æ¨™ |
| `radius_m` | int | æœå°‹åŠå¾‘ï¼ˆå…¬å°ºï¼‰ |
| `tz` | string | æ™‚å€ |

#### `summary` ç‰©ä»¶
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `safety_score` | number | å®‰å…¨åˆ†æ•¸ï¼ˆ0-100ï¼‰ï¼ŒåŸºæ–¼å‘¨åœè³‡æºè¨ˆç®— |
| `analysis` | object | å„é¡è³‡æºçµ±è¨ˆæ•¸é‡ |

#### `resources` ç‰©ä»¶
åŒ…å«äº”ç¨®è³‡æºé¡å‹ï¼Œæ¯ç¨®é¡å‹æœ€å¤šå›å‚³ 2 ç­†æœ€è¿‘çš„è³‡æ–™ï¼š
- `cctv`: ç›£è¦–å™¨
- `metro`: æ·é‹ç«™å‡ºå£
- `criminal`: æ¶å¥ªæ¡ˆä»¶ï¼ˆè² é¢å› ç´ ï¼‰
- `streetlight`: è·¯ç‡ˆ
- `police`: è­¦å±€

#### è³‡æºé …ç›®é€šç”¨æ¬„ä½
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `safety` | int | å®‰å…¨ä¿‚æ•¸ï¼š`1=æ­£é¢`ã€`-1=è² é¢` |
| `type` | string | è³‡æºé¡å‹ |
| `name` | string | åç¨± |
| `location` | object | åº§æ¨™ `{lat, lng}` |
| `distance_m` | int | èˆ‡ä¸­å¿ƒé»è·é›¢ï¼ˆå…¬å°ºï¼‰ |
| `phone` | string | è¯çµ¡é›»è©± |

#### æ¶å¥ªæ¡ˆä»¶é¡å¤–æ¬„ä½
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `incident_date` | string | ç™¼ç”Ÿæ—¥æœŸ |
| `incident_time` | string | ç™¼ç”Ÿæ™‚æ®µ |
| `location_desc` | string | ç™¼ç”Ÿåœ°é»æè¿° |

---

## ğŸ—ºï¸ `GET /get_nearby_roads_safety`

### èªªæ˜
å–å¾—æŒ‡å®šä½ç½®å‘¨åœé“è·¯çš„å®‰å…¨è©•åˆ†ï¼Œåˆ†ææ¯æ¢é“è·¯å‘¨é‚Šçš„å®‰å…¨è³‡æºã€‚

### Query åƒæ•¸
| åƒæ•¸ | é¡å‹ | å¿…å¡« | é è¨­å€¼ | èªªæ˜ |
|------|------|------|--------|------|
| `center_lat` | number | âœ… | - | ä¸­å¿ƒé»ç·¯åº¦ |
| `center_lng` | number | âœ… | - | ä¸­å¿ƒé»ç¶“åº¦ |
| `search_radius_m` | int | âŒ | 500 | æœå°‹é“è·¯çš„ç¯„åœï¼ˆå…¬å°ºï¼‰ |
| `safety_radius_m` | int | âŒ | 200 | è¨ˆç®—æ¯æ¢é“è·¯å®‰å…¨è³‡æºçš„ç¯„åœï¼ˆå…¬å°ºï¼‰ |

### ç¯„ä¾‹è«‹æ±‚
```bash
curl -X GET "http://localhost:5001/get_nearby_roads_safety?center_lat=25.033964&center_lng=121.564468&search_radius_m=500&safety_radius_m=200"
```

### æˆåŠŸå›å‚³ç¯„ä¾‹
```json
{
  "center": { "lat": 25.033964, "lng": 121.564468 },
  "search_radius_m": 500,
  "safety_radius_m": 200,
  "summary": {
    "total_roads": 15,
    "total_cctv": 45,
    "total_metro": 8,
    "total_robbery": 3,
    "total_streetlight": 120,
    "total_police": 2,
    "overall_score": 62.3
  },
  "roads": [
    {
      "road_name": "å¸‚åºœè·¯",
      "road_type": "primary",
      "nodes": [
        [25.03401, 121.56445],
        [25.03398, 121.56512],
        [25.03395, 121.56578]
      ],
      "center": { "lat": 25.03398, "lng": 121.56512 },
      "cctv_count": 5,
      "metro_count": 1,
      "robbery_count": 0,
      "streetlight_count": 12,
      "police_count": 0,
      "safety_score": 68.5
    }
  ]
}
```

### å›å‚³æ¬„ä½èªªæ˜

#### `summary` ç‰©ä»¶
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `total_roads` | int | æ‰¾åˆ°çš„é“è·¯ç¸½æ•¸ |
| `total_cctv` | int | æ‰€æœ‰é“è·¯å‘¨åœçš„ç›£è¦–å™¨ç¸½æ•¸ |
| `total_metro` | int | æ‰€æœ‰é“è·¯å‘¨åœçš„æ·é‹ç«™ç¸½æ•¸ |
| `total_robbery` | int | æ‰€æœ‰é“è·¯å‘¨åœçš„æ¶å¥ªæ¡ˆä»¶ç¸½æ•¸ |
| `total_streetlight` | int | æ‰€æœ‰é“è·¯å‘¨åœçš„è·¯ç‡ˆç¸½æ•¸ |
| `total_police` | int | æ‰€æœ‰é“è·¯å‘¨åœçš„è­¦å±€ç¸½æ•¸ |
| `overall_score` | number | æ•´é«”å€åŸŸå®‰å…¨åˆ†æ•¸ï¼ˆ0-100ï¼‰ |

#### `roads[]` é™£åˆ—é …ç›®
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `road_name` | string | é“è·¯åç¨± |
| `road_type` | string | é“è·¯é¡å‹ï¼ˆprimary, secondary, residential ç­‰ï¼‰ |
| `nodes` | array | é“è·¯ç¯€é»åº§æ¨™é™£åˆ— `[[lat, lng], ...]` |
| `center` | object | é“è·¯ä¸­å¿ƒé»åº§æ¨™ |
| `cctv_count` | int | è©²é“è·¯å‘¨åœçš„ç›£è¦–å™¨æ•¸é‡ |
| `metro_count` | int | è©²é“è·¯å‘¨åœçš„æ·é‹ç«™æ•¸é‡ |
| `robbery_count` | int | è©²é“è·¯å‘¨åœçš„æ¶å¥ªæ¡ˆä»¶æ•¸é‡ |
| `streetlight_count` | int | è©²é“è·¯å‘¨åœçš„è·¯ç‡ˆæ•¸é‡ |
| `police_count` | int | è©²é“è·¯å‘¨åœçš„è­¦å±€æ•¸é‡ |
| `safety_score` | number | è©²é“è·¯çš„å®‰å…¨åˆ†æ•¸ï¼ˆ0-100ï¼‰ |

---

## ğŸ›£ï¸ `GET /get_route_safety`

### èªªæ˜
è¨ˆç®—å…©é»ä¹‹é–“è·¯ç·šçš„å®‰å…¨è©•åˆ†ï¼Œåˆ†æè·¯ç·šä¸Šæ‰€æœ‰é“è·¯çš„å®‰å…¨è³‡æºã€‚

### Query åƒæ•¸
| åƒæ•¸ | é¡å‹ | å¿…å¡« | é è¨­å€¼ | èªªæ˜ |
|------|------|------|--------|------|
| `start_lat` | number | âœ… | - | èµ·é»ç·¯åº¦ |
| `start_lng` | number | âœ… | - | èµ·é»ç¶“åº¦ |
| `end_lat` | number | âœ… | - | çµ‚é»ç·¯åº¦ |
| `end_lng` | number | âœ… | - | çµ‚é»ç¶“åº¦ |
| `radius_m` | int | âŒ | 200 | è·¯ç·šå‘¨åœå®‰å…¨è³‡æºçš„æœå°‹ç¯„åœï¼ˆå…¬å°ºï¼‰ |

### ç¯„ä¾‹è«‹æ±‚
```bash
curl -X GET "http://localhost:5001/get_route_safety?start_lat=25.033964&start_lng=121.564468&end_lat=25.041234&end_lng=121.567890&radius_m=200"
```

### æˆåŠŸå›å‚³ç¯„ä¾‹
```json
{
  "route": {
    "start": { "lat": 25.033964, "lng": 121.564468 },
    "end": { "lat": 25.041234, "lng": 121.567890 },
    "radius_m": 200
  },
  "summary": {
    "total_segments": 22,
    "total_cctv": 67,
    "total_metro": 12,
    "total_robbery": 2,
    "total_streetlight": 180,
    "total_police": 3,
    "overall_score": 71.8
  },
  "segments": [
    {
      "road_name": "å¿ å­æ±è·¯",
      "road_type": "primary",
      "nodes": [
        [25.03401, 121.56445],
        [25.03398, 121.56512]
      ],
      "center": { "lat": 25.034, "lng": 121.56479 },
      "cctv_count": 8,
      "metro_count": 2,
      "robbery_count": 0,
      "streetlight_count": 15,
      "police_count": 1,
      "safety_score": 78.2,
      "features": [
        {
          "type": "cctv",
          "name": "CAM-12345",
          "lat": 25.03452,
          "lng": 121.56501,
          "distance": 65.5
        }
      ]
    }
  ]
}
```

### å›å‚³æ¬„ä½èªªæ˜

#### `route` ç‰©ä»¶
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `start` | object | èµ·é»åº§æ¨™ `{lat, lng}` |
| `end` | object | çµ‚é»åº§æ¨™ `{lat, lng}` |
| `radius_m` | int | æœå°‹ç¯„åœï¼ˆå…¬å°ºï¼‰ |

#### `summary` ç‰©ä»¶
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `total_segments` | int | è·¯ç·šä¸Šçš„é“è·¯æ®µæ•¸ |
| `total_cctv` | int | è·¯ç·šå‘¨åœçš„ç›£è¦–å™¨ç¸½æ•¸ |
| `total_metro` | int | è·¯ç·šå‘¨åœçš„æ·é‹ç«™ç¸½æ•¸ |
| `total_robbery` | int | è·¯ç·šå‘¨åœçš„æ¶å¥ªæ¡ˆä»¶ç¸½æ•¸ |
| `total_streetlight` | int | è·¯ç·šå‘¨åœçš„è·¯ç‡ˆç¸½æ•¸ |
| `total_police` | int | è·¯ç·šå‘¨åœçš„è­¦å±€ç¸½æ•¸ |
| `overall_score` | number | æ•´é«”è·¯ç·šå®‰å…¨åˆ†æ•¸ï¼ˆ0-100ï¼‰ |

#### `segments[]` é™£åˆ—é …ç›®
èˆ‡ `/get_nearby_roads_safety` çš„ `roads[]` ç›¸åŒï¼Œä½†é¡å¤–åŒ…å«ï¼š

| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `features` | array | è©²é“è·¯æ®µå‘¨åœçš„å®‰å…¨è³‡æºè©³ç´°åˆ—è¡¨ |

#### `features[]` é™£åˆ—é …ç›®
| æ¬„ä½ | å‹åˆ¥ | èªªæ˜ |
|------|------|------|
| `type` | string | è³‡æºé¡å‹ï¼ˆcctv, metro, robbery_incident, streetlight, policeï¼‰ |
| `name` | string | åç¨± |
| `lat` | number | ç·¯åº¦ |
| `lng` | number | ç¶“åº¦ |
| `distance` | number | èˆ‡é“è·¯ä¸­å¿ƒé»çš„è·é›¢ï¼ˆå…¬å°ºï¼‰ |
| `incident_date` | string | ï¼ˆåƒ…æ¶å¥ªæ¡ˆä»¶ï¼‰ç™¼ç”Ÿæ—¥æœŸ |
| `incident_time` | string | ï¼ˆåƒ…æ¶å¥ªæ¡ˆä»¶ï¼‰ç™¼ç”Ÿæ™‚æ®µ |


---

## ğŸ“Š å®‰å…¨åˆ†æ•¸è¨ˆç®—èªªæ˜

### è¨ˆç®—å…¬å¼
å®‰å…¨åˆ†æ•¸åŸºæ–¼ä»¥ä¸‹å› ç´ è¨ˆç®—ï¼ˆ0-100 åˆ†ï¼‰ï¼š

```
score = 0.1Ã—ç›£è¦–å™¨ + 0.05Ã—è·¯ç‡ˆ + 0.2Ã—æ·é‹ç«™ + 0.3Ã—è­¦å±€ - 0.4Ã—ç«Šç›œ - 0.5Ã—æ¶å¥ª
```

å„é …ç›®æœƒå…ˆæ­£è¦åŒ–åˆ° 0-1 ä¹‹é–“ï¼Œç„¶å¾Œå¥—ç”¨æ¬Šé‡è¨ˆç®—ã€‚

### å®‰å…¨ç­‰ç´šåŠƒåˆ†

| ç­‰ç´š | åˆ†æ•¸å€é–“ | èªªæ˜ | å»ºè­° UI é¡è‰² | ç‹€æ…‹æç¤ºæ–‡å­— |
|:-----|:--------:|:-----|:------------:|:-------------|
| **å®‰å…¨ (Safe)** | **75 â€“ 100** | å€åŸŸæ˜äº®ã€ç›£è¦–å™¨å¯†é›†ã€æ·é‹ç«™æˆ–è­¦å±€è¿‘ï¼Œç„¡è¿‘æœŸæ¡ˆä»¶ç´€éŒ„ | ğŸŸ¢ ç¶ è‰² `#3CCF4E` | ã€Œæ­¤å€åŸŸå®‰å…¨ã€ |
| **éœ€ç•™æ„ (Caution)** | **35 â€“ 74** | æœ‰åŸºæœ¬å®‰å…¨è¨­æ–½ï¼Œä½†å¯èƒ½å…‰ç·šä¸è¶³æˆ–æœ‰å°‘é‡æ¡ˆä»¶ç´€éŒ„ | ğŸŸ¡ é»ƒè‰² `#FFC107` | ã€Œæ­¤å€éœ€ç•™æ„ï¼Œå»ºè­°çµä¼´æˆ–ç•™æ„å‘¨é­ã€ |
| **å±éšª (Danger)** | **0 â€“ 34** | å®‰å…¨è¨­æ–½ä¸è¶³ã€ç…§æ˜å·®ï¼Œæˆ–æœ‰è¼ƒå¤šæ¡ˆä»¶ç´€éŒ„ | ğŸ”´ ç´…è‰² `#FF5252` | ã€Œæ­¤å€å¤œé–“é¢¨éšªé«˜ï¼Œå»ºè­°é¿é–‹ã€ |

### æ­£è¦åŒ–åƒæ•¸ï¼ˆé è¨­å€¼ï¼‰
- ç›£è¦–å™¨ï¼šæœ€å¤§æœŸæœ›å€¼ 50 å€‹
- è·¯ç‡ˆï¼šæœ€å¤§æœŸæœ›å€¼ 100 å€‹
- æ·é‹ç«™ï¼šæœ€å¤§æœŸæœ›å€¼ 10 å€‹
- è­¦å±€ï¼šæœ€å¤§æœŸæœ›å€¼ 5 å€‹
- ç«Šç›œæ¡ˆä»¶ï¼šåƒè€ƒå€¼ 5 ä»¶
- æ¶å¥ªæ¡ˆä»¶ï¼šåƒè€ƒå€¼ 2 ä»¶

---

## ğŸš« éŒ¯èª¤å›å‚³æ ¼å¼

### åƒæ•¸éŒ¯èª¤
```json
{
  "error": "Missing required parameters"
}
```

### Overpass API éŒ¯èª¤
```json
{
  "error": "Overpass API error: [éŒ¯èª¤è¨Šæ¯]"
}
```

### è³‡æ–™ç²å–å¤±æ•—
```json
{
  "error": "Failed to fetch safety data: [éŒ¯èª¤è¨Šæ¯]"
}
```

| HTTP ç‹€æ…‹ | æ„ç¾© |
|------------|------|
| 400 | åƒæ•¸éŒ¯èª¤æˆ–ç¼ºå°‘å¿…è¦åƒæ•¸ |
| 500 | ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤æˆ–å¤–éƒ¨ API å‘¼å«å¤±æ•— |

---

## ğŸ§° é–‹ç™¼è€…æç¤º

### API é¸æ“‡å»ºè­°
- æŸ¥è©¢å–®é»å‘¨åœå®‰å…¨è³‡æº â†’ `/get_safety_data`
- åˆ†æç‰¹å®šå€åŸŸçš„é“è·¯å®‰å…¨ â†’ `/get_nearby_roads_safety`
- è¨ˆç®—å…©é»é–“è·¯ç·šå®‰å…¨ â†’ `/get_route_safety`

### æ³¨æ„äº‹é …
- æ‰€æœ‰æ™‚é–“ä»¥ `Asia/Taipei` ç‚ºä¸»
- åº§æ¨™ç³»çµ±ä½¿ç”¨ WGS84ï¼ˆGPS æ¨™æº–ï¼‰
- è·¯ç‡ˆè³‡æ–™æœƒè‡ªå‹•å¾ TWD97 è½‰æ›ç‚º WGS84
- Overpass API æŸ¥è©¢æœƒæ’é™¤é«˜é€Ÿå…¬è·¯å’Œå¿«é€Ÿé“è·¯
- æ¯å€‹è³‡æºé¡å‹åœ¨ `/get_safety_data` ä¸­æœ€å¤šå›å‚³ 2 ç­†æœ€è¿‘çš„è³‡æ–™
- å»ºè­° `radius_m` è¨­å®šåœ¨ 100-500 å…¬å°ºä¹‹é–“ä»¥ç²å¾—æœ€ä½³æ•ˆèƒ½

### è³‡æ–™ä¾†æº
- ç›£è¦–å™¨ï¼šå°åŒ—å¸‚æ”¿åºœé–‹æ”¾è³‡æ–™
- æ·é‹ç«™ï¼šå°åŒ—å¸‚æ”¿åºœé–‹æ”¾è³‡æ–™
- æ¶å¥ªæ¡ˆä»¶ï¼šå°åŒ—å¸‚æ”¿åºœé–‹æ”¾è³‡æ–™
- è·¯ç‡ˆï¼šå°åŒ—å¸‚è·¯ç‡ˆç®¡ç†ç³»çµ±
- è­¦å±€ï¼šå°åŒ—å¸‚æ”¿åºœé–‹æ”¾è³‡æ–™
- é“è·¯è³‡æ–™ï¼šOpenStreetMap (via Overpass API)